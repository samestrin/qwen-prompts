# ---------------------------------------------------------------------------
# Command: /plan
#
# Description:
#   Calls the Gemini CLI to investigate and create a strategic plan to
#   accomplish a task without writing any code.
#
# Usage Examples:
#
#   1. Create a plan for a new feature:
#      /plan to implement a two-factor authentication system
#
#   2. Devise a refactoring strategy:
#      /plan a strategy to refactor the legacy user model to use the new repository pattern
# ---------------------------------------------------------------------------

name = "plan"
description = "Investigates and creates a strategic plan to accomplish a task."

prompt = """
The **MAIN_DIRECTORY** is "`gemini -p "Analyze @package.json, @composer.json, or @pyproject.toml to identify the primary source code directory. Look for:

1. **pyproject.toml**: Check `[tool.setuptools.packages.find]` include patterns, `[project.scripts]` entry points, or `[tool.setuptools.package-data]` keys
2. **package.json**: Check `main`, `module`, or `exports` fields pointing to source directories
3. **composer.json**: Check `autoload.psr-4` namespace mappings

Return the actual package/module directory name that contains the application logic (not generic names like "src"). Print only the directory name without explanation.`"

Your primary role is that of a strategist, not an implementer.

### Plan
`gemini -p "@{MAIN_DIRECTORY} Your primary role is that of a strategist, not an implementer.
Your task is to stop, think deeply, and devise a comprehensive strategic plan to accomplish the following goal: {{args}}

You MUST NOT write, modify, or execute any code. Your sole function is to investigate the current state and formulate a plan.

Use your available 'read' and 'search' tools to research and analyze the codebase. Gather all necessary context before presenting your strategy.

Present your strategic plan in markdown. It should be the direct result of your investigation and thinking process. Structure your response with the following sections:

1.  **Understanding the Goal:** Re-state the objective to confirm your understanding.
2.  **Investigation & Analysis:** Describe the investigative steps you would take. What files would you need to read? What would you search for? What critical questions need to be answered before any work begins?
3.  **Proposed Strategic Approach:** Outline the high-level strategy. Break the approach down into logical phases and describe the work that should happen in each.
4.  **Verification Strategy:** Explain how the success of this plan would be measured. What should be tested to ensure the goal is met without introducing regressions?
5.  **Anticipated Challenges & Considerations:** Based on your analysis, what potential risks, dependencies, or trade-offs do you foresee?

Your final output should be ONLY this strategic plan."`

---

Carefully review the Plan, correct any formatting issues, and display in properly formatted **Markdown**. 

Then **hard stop**.
"""
